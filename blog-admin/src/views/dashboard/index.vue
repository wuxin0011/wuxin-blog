<template>
<div class="dashboard-container">
    <!-- <el-alert :title="`登录成功！欢迎用户${name}`" type="success" center /> -->
    <el-row :gutter="20" class="panel-group">
        <el-col :xs="24" :sm="12" :lg="6" class="card-panel-col">
            <el-card shadow="hover" @click.prevent.native="goAccessLogList()">
                <div class="card-panel">
                    <div class="card-panel-icon-wrapper">
                        <svg t="1640584335788" class="icon" viewBox="0 0 1131 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18118" width="60" height="60">
                            <path d="M754.526316 848.572632a202.105263 202.105263 0 0 1 377.263158-100.783158V134.736842a134.736842 134.736842 0 0 0-134.736842-134.736842H134.736842a134.736842 134.736842 0 0 0-134.736842 134.736842v754.526316a134.736842 134.736842 0 0 0 134.736842 134.736842h721.92A201.835789 201.835789 0 0 1 754.526316 848.572632z m-61.170527-278.63579l-92.698947-280.522105L473.465263 673.684211a31.528421 31.528421 0 0 1-37.995789 19.132631 29.642105 29.642105 0 0 1-20.48-16.168421l-94.31579-195.098947-65.751579 97.818947a32.336842 32.336842 0 0 1-26.947368 13.473684h-61.978948a28.833684 28.833684 0 1 1 0-57.397894h45.271579l86.501053-127.730527a29.911579 29.911579 0 0 1 15.090526-12.934737 32.336842 32.336842 0 0 1 33.953685 5.389474 26.947368 26.947368 0 0 1 6.467368 9.701053l83.806316 173.810526 133.658947-399.898947a31.797895 31.797895 0 0 1 6.736842-10.778948 32.875789 32.875789 0 0 1 15.36-8.353684 30.989474 30.989474 0 0 1 38.534737 18.863158l116.682105 351.932632h131.772632a26.947368 26.947368 0 0 1 7.814737 0 61.978947 61.978947 0 0 1 52.008421-33.145264 59.553684 59.553684 0 0 1 57.397895 61.978948 60.362105 60.362105 0 0 1-58.206316 61.978947A63.326316 63.326316 0 0 1 886.568421 592.842105a26.947368 26.947368 0 0 1-7.814737 0h-154.947368a30.72 30.72 0 0 1-30.450527-22.905263z" fill="#2256ED" p-id="18119" />
                            <path d="M1081.397895 816.774737a149.288421 149.288421 0 0 0-249.263158 0 53.894737 53.894737 0 0 0 0 63.326316 149.288421 149.288421 0 0 0 249.263158 0 53.894737 53.894737 0 0 0 0-63.326316z m-124.496842 94.585263a63.056842 63.056842 0 1 1 62.787368-62.787368 62.787368 62.787368 0 0 1-62.787368 62.787368z m0-107.789474a45.002105 45.002105 0 1 0 0 89.734737 45.002105 45.002105 0 0 0 0-89.734737z" fill="#2256ED" p-id="18120" />
                        </svg>
                    </div>
                    <div class="card-panel-description">
                        <div class="card-panel-text">访问统计</div>
                        <count-to :start-val="0" :end-val="map['access']" :duration="2600" class="card-panel-num" />
                    </div>
                </div>
            </el-card>
        </el-col>
        <el-col :xs="24" :sm="12" :lg="6" class="card-panel-col">
            <el-card shadow="hover" @click.prevent.native="goLoginLogList()">
                <div class="card-panel">
                    <div class="card-panel-icon-wrapper">
                        <svg t="1640584905882" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="27232" width="60" height="60">
                            <path d="M858.3 792.5c35.4-29.4 57.9-73.7 57.9-123.1 0-88.2-71.8-160-160-160s-160 71.8-160 160c0 49.5 22.6 93.7 57.9 123.1-20.5 10.5-39.5 24.3-56.3 41.1-42.3 42.3-65.6 98.6-65.6 158.4 0 17.7 14.3 32 32 32s32-14.3 32-32c0-88.2 71.8-160 160-160s160 71.8 160 160c0 17.7 14.3 32 32 32s32-14.3 32-32c0-59.8-23.3-116.1-65.6-158.4-16.8-16.8-35.8-30.6-56.3-41.1z m-102.1-27.1c-52.9 0-96-43.1-96-96s43.1-96 96-96 96 43.1 96 96-43.1 96-96 96zM416 640c-17.7 0-32 14.3-32 32v320c0 17.7 14.3 32 32 32s32-14.3 32-32V672c0-17.7-14.3-32-32-32zM288 512c-17.7 0-32 14.3-32 32v448c0 17.7 14.3 32 32 32s32-14.3 32-32V544c0-17.7-14.3-32-32-32zM160 704c-17.7 0-32 14.3-32 32v256c0 17.7 14.3 32 32 32s32-14.3 32-32V736c0-17.7-14.3-32-32-32z" fill="#1296db" p-id="27233" />
                            <path d="M1023.9 29.4c0-0.3 0-0.5-0.1-0.8 0-0.2-0.1-0.5-0.1-0.7 0-0.3-0.1-0.6-0.1-0.9 0-0.2-0.1-0.4-0.1-0.6-0.1-0.3-0.1-0.7-0.2-1 0-0.1-0.1-0.3-0.1-0.4-0.1-0.4-0.2-0.7-0.3-1.1 0-0.1-0.1-0.2-0.1-0.3l-0.3-1.2c0-0.1-0.1-0.3-0.1-0.4-0.1-0.4-0.2-0.7-0.4-1.1-0.1-0.2-0.2-0.4-0.3-0.7s-0.2-0.5-0.3-0.8c-0.1-0.3-0.3-0.6-0.4-0.9-0.1-0.2-0.1-0.3-0.2-0.5-0.2-0.3-0.3-0.7-0.5-1-0.1-0.1-0.1-0.3-0.2-0.4-0.2-0.3-0.4-0.6-0.5-0.9-0.1-0.1-0.2-0.3-0.3-0.4-0.2-0.3-0.3-0.5-0.5-0.8-0.1-0.2-0.2-0.4-0.3-0.5-0.2-0.2-0.3-0.5-0.5-0.7-0.1-0.2-0.3-0.4-0.4-0.6-0.1-0.2-0.3-0.4-0.5-0.6-0.2-0.2-0.4-0.5-0.5-0.7-0.1-0.2-0.3-0.3-0.4-0.5-0.2-0.2-0.4-0.5-0.6-0.7l-0.2-0.2-0.3-0.3-0.6-0.6c-0.2-0.2-0.4-0.4-0.6-0.5-0.2-0.2-0.4-0.3-0.6-0.5-0.2-0.2-0.4-0.4-0.7-0.6-0.2-0.1-0.3-0.3-0.5-0.4-0.3-0.2-0.5-0.4-0.8-0.6-0.1-0.1-0.3-0.2-0.4-0.3-0.3-0.2-0.6-0.4-0.8-0.6-0.1-0.1-0.3-0.2-0.4-0.3l-0.9-0.6c-0.1-0.1-0.3-0.2-0.4-0.3-0.3-0.2-0.6-0.3-0.9-0.5-0.2-0.1-0.3-0.2-0.5-0.3-0.3-0.1-0.6-0.3-0.8-0.4l-0.6-0.3c-0.2-0.1-0.5-0.2-0.8-0.3-0.2-0.1-0.5-0.2-0.7-0.3-0.2-0.1-0.4-0.2-0.7-0.3l-0.9-0.3c-0.2-0.1-0.4-0.1-0.6-0.2-0.3-0.1-0.6-0.2-1-0.3-0.2 0-0.3-0.1-0.5-0.1-0.3-0.1-0.7-0.2-1-0.3-0.2 0-0.3-0.1-0.5-0.1-0.3-0.1-0.7-0.1-1-0.2-0.2 0-0.4-0.1-0.5-0.1-0.3-0.1-0.6-0.1-1-0.1-0.2 0-0.4-0.1-0.6-0.1-0.3 0-0.6-0.1-0.9-0.1-0.3 0-0.5 0-0.8-0.1H799.9c-17.7 0-32 14.3-32 32s14.3 32 32 32h111.2L480.7 467.5l-170-170.1c-12.5-12.5-32.8-12.5-45.3 0l-256 256c-12.5 12.5-12.5 32.8 0 45.3 6.2 6.2 14.4 9.4 22.6 9.4s16.4-3.1 22.6-9.4l233.5-233.4 169.4 169.4c12.2 12.2 31.9 12.5 44.5 0.7l458-429.5v118.3c0 17.7 14.3 32 32 32s32-14.3 32-32V32v-0.2-0.9-0.7c0-0.3 0-0.6-0.1-0.8z" fill="#1296db" p-id="27234" />
                        </svg>
                    </div>
                    <div class="card-panel-description">
                        <div class="card-panel-text">用户访问</div>
                        <count-to :start-val="0" :end-val="map['login']" :duration="2600" class="card-panel-num" />
                    </div>
                </div>
            </el-card>
        </el-col>
        <el-col :xs="24" :sm="12" :lg="6" class="card-panel-col">
            <el-card shadow="hover" @click.prevent.native="goCommentList()">
                <div class="card-panel">
                    <div class="card-panel-icon-wrapper">
                        <svg t="1640585010937" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="27992" width="60" height="60">
                            <path d="M837.176889 144.099556a130.048 130.048 0 0 1 130.048 130.048L967.111111 511.943111h-58.936889V274.204444c0-39.253333-31.800889-71.054222-70.997333-71.054222H186.936889c-39.253333 0-70.997333 31.857778-70.997333 71.054222v459.207112c0 39.196444 31.800889 70.997333 70.997333 70.997333h233.073778c6.257778 0 12.174222 1.934222 17.237333 5.518222l83.797333 60.416 47.843556-37.888v75.207111l-28.728889 22.755556a29.468444 29.468444 0 0 1-35.555556 0.853333l-94.094222-67.697778h-223.573333A130.048 130.048 0 0 1 56.888889 733.297778V274.147556A130.048 130.048 0 0 1 186.936889 144.099556h650.24z" p-id="27993" fill="#d4237a" />
                            <path d="M284.444444 455.111111m-56.888888 0a56.888889 56.888889 0 1 0 113.777777 0 56.888889 56.888889 0 1 0-113.777777 0Z" p-id="27994" fill="#d4237a" />
                            <path d="M512 455.111111m-56.888889 0a56.888889 56.888889 0 1 0 113.777778 0 56.888889 56.888889 0 1 0-113.777778 0Z" p-id="27995" fill="#d4237a" />
                            <path d="M739.555556 455.111111m-56.888889 0a56.888889 56.888889 0 1 0 113.777777 0 56.888889 56.888889 0 1 0-113.777777 0Z" p-id="27996" fill="#d4237a" />
                            <path d="M682.666667 739.555556m28.444444 0l0 0q28.444444 0 28.444445 28.444444l0 56.888889q0 28.444444-28.444445 28.444444l0 0q-28.444444 0-28.444444-28.444444l0-56.888889q0-28.444444 28.444444-28.444444Z" p-id="27997" fill="#d4237a" />
                            <path d="M682.666667 910.222222m28.444444 0l227.555556 0q28.444444 0 28.444444 28.444445l0 0q0 28.444444-28.444444 28.444444l-227.555556 0q-28.444444 0-28.444444-28.444444l0 0q0-28.444444 28.444444-28.444445Z" p-id="27998" fill="#d4237a" />
                            <path d="M796.444444 682.666667m28.444445 0l0 0q28.444444 0 28.444444 28.444444l0 113.777778q0 28.444444-28.444444 28.444444l0 0q-28.444444 0-28.444445-28.444444l0-113.777778q0-28.444444 28.444445-28.444444Z" p-id="27999" fill="#d4237a" />
                            <path d="M938.666667 568.888889a28.444444 28.444444 0 0 1 28.444444 28.444444v227.555556a28.444444 28.444444 0 1 1-56.888889 0v-227.555556a28.444444 28.444444 0 0 1 28.444445-28.444444z" p-id="28000" fill="#d4237a" />
                        </svg>
                    </div>
                    <div class="card-panel-description">
                        <div class="card-panel-text">今日评论</div>
                        <count-to :start-val="0" :end-val="map['comment']" :duration="2600" class="card-panel-num" />
                    </div>
                </div>
            </el-card>
        </el-col>
        <el-col :xs="24" :sm="12" :lg="6" class="card-panel-col">
            <el-card shadow="hover" @click.native.prevent="goBlogList()">
                <div class="card-panel">
                    <div class="card-panel-icon-wrapper">
                        <svg t="1640584685967" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="24432" width="60" height="60">
                            <path d="M321.81278392 573.53861979h380.35371995v35.88242647H321.81278392zM321.81278392 688.37274039h380.35371995v35.88242646H321.81278392zM321.81278392 458.71485529h380.35371995v35.88242648H321.81278392z" fill="#E19659" p-id="24433" />
                            <path d="M898.73799592 14.77726893h-773.46563573c-61.02601401 0-110.49509126 49.46907725-110.49509126 110.49509126v773.46563573c0 61.02601401 49.46907725 110.49509126 110.49509126 110.49509126h773.46563573c61.02601401 0 110.49509126-49.46907725 110.49509126-110.49509126v-773.46563573c0-61.02601401-49.46907725-110.49509126-110.49509126-110.49509126zM790.53150982 789.96194807a53.53885831 53.53885831 0 0 1-53.5492144 53.52850222H287.03841576a53.53885831 53.53885831 0 0 1-53.55957051-53.52850222V234.07947529a53.56992558 53.56992558 0 0 1 53.55957051-53.55957051h316.39704839v101.33031551c0 48.51635426 39.47584654 87.98184574 88.0025569 87.98184574h99.09348877v420.12988204z m-99.09348877-454.58322453a53.53885831 53.53885831 0 0 1-53.55956948-53.52850325v-101.33031551L790.53150982 335.37872354h-99.09348877z" fill="#E19659" p-id="24434" />
                        </svg>
                    </div>
                    <div class="card-panel-description">
                        <div class="card-panel-text">文章统计</div>
                        <count-to :start-val="0" :end-val="map['blog']" :duration="2600" class="card-panel-num" />
                    </div>
                </div>
            </el-card>
        </el-col>
    </el-row>
    <el-row :gutter="20" style="margin-top: 10px">
        <el-col :xs="24" :sm="12" :lg="12">
            <el-card shadow="hover" style="text-align:center;">
                <div ref="category" class="m-margin-tb-large m-echarts-container" />
            </el-card>
        </el-col>
        <el-col ::xs="24" :sm="12" :lg="12">
            <el-card shadow="hover" style="text-align:center;">
                <div ref="tag" class=" m-margin-tb-large m-echarts-container" />
            </el-card>
        </el-col>
    </el-row>

    <el-row>
        <el-col>
            <el-card shadow="hover">
                <div ref="visitorCount" class="m-echarts-container" />
            </el-card>
        </el-col>
    </el-row>
</div>
</template>

<script>
import {
    mapGetters
} from 'vuex'
import CountTo from 'vue-count-to'
import VisitorMap from '@/views/dashboard/components/visitor_map'
import VisitorCount from '@/views/dashboard/components/visit'
import {
    getDashboardCardCount
} from '@/api/dashboard'
export default {
    name: 'Dashboard',
    components: {
        CountTo,
        VisitorCount,
        VisitorMap,
    },
    data() {
        return {
            map: {},
        }
    },
    // computed: {
    //     ...mapGetters(['name', 'avatar', 'roles'])
    // },
    created() {
        this.getData();
    },

    methods: {
        getData() {
            getDashboardCardCount().then((res) => {
                if (res.code === 200) {
                    this.map = res
                    this.$nextTick(() => {
                        this.tagMap()
                        this.categoryMap()
                        this.accessLogin()
                    })
                }
            })
        },

        async tagMap() {
            var myChart = this.$echarts.init(this.$refs.tag)
            const option = {
                title: {
                    text: '标签下的文章',
                    subtext: 'tag',
                    left: 'center'
                },
                legend: {
                    top: 'bottom'
                },
                tooltip: {
                    trigger: 'item'
                },
                toolbox: {
                    feature: {
                        saveAsImage: {}
                    }
                },

                series: [{
                    name: '标签分类下的文章',
                    type: 'pie',
                    radius: [50, 80],
                    center: ['50%', '50%'],
                    roseType: 'area',
                    itemStyle: {
                        borderRadius: 8
                    },
                    data: this.map['tag']
                }]
            }
            myChart && myChart.setOption(option)
        },

        categoryMap() {
            var mychart = this.$echarts.init(this.$refs.category)
            const option = {
                title: {
                    text: '分类下的文章',
                    subtext: 'category',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    bottom: 'bottom'
                },
                toolbox: {
                    feature: {
                        saveAsImage: {}
                    }
                },
                series: [{
                    name: '分类',
                    type: 'pie',
                    radius: '50%',
                    data: this.map['category'],
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            }
            mychart && mychart.setOption(option)
        },

        accessLogin() {

            let dateList = []
            let accessList = []
            let loginList = []

            this.map['accessLogin'].forEach((item) => {
                dateList.push(item['date'])
                accessList.push(item['access'])
                loginList.push(item['login'])
            })

            const myChart = this.$echarts.init(this.$refs.visitorCount)
            const option = {
                title: {
                    text: '访问统计',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: ['Email', 'Union Ads', 'Video Ads', 'Direct', 'Search Engine']
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                toolbox: {
                    feature: {
                        saveAsImage: {}
                    }
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: dateList
                },
                yAxis: {
                    type: 'value'
                },
                series: [{
                        name: '访问',
                        type: 'line',
                        stack: 'Total',
                        data: accessList
                    },
                    {
                        name: '登录',
                        type: 'line',
                        stack: 'Total',
                        data: loginList
                    }
                ]
            }
            myChart & myChart.setOption(option)
        },

        goBlogList() {
            this.$router.push('/page/blog/list')
        },
        goAccessLogList() {
            this.$router.push('/log/access')
        },
        goLoginLogList() {
            this.$router.push('/log/login')
        },
        goCommentList() {
            this.$router.push('/page/blog/commentAll')
        }
    },
}
</script>

<style lang="scss" scoped>
.panel-group {
    margin-top: 18px;

    .card-panel-col {
        margin-bottom: 5px;
    }

    .card-panel {
        height: 108px;
        cursor: pointer;
        font-size: 12px;
        position: relative;
        overflow: hidden;
        color: #666;
        background: #fff;
        box-shadow: 4px 4px 40px rgba(0, 0, 0, 0.05);
        border-color: rgba(0, 0, 0, 0.05);

        .card-panel-icon-wrapper {
            float: left;
            margin: 14px 0 0 14px;
            padding: 16px;
            transition: all 0.38s ease-out;
            border-radius: 6px;
        }

        .card-panel-icon {
            float: left;
            font-size: 48px;
        }

        .card-panel-description {
            float: right;
            font-weight: bold;
            margin: 26px 26px 26px 0px;

            .card-panel-text {
                line-height: 18px;
                color: rgba(0, 0, 0, 0.45);
                font-size: 16px;
                margin-bottom: 12px;
            }

            .card-panel-num {
                font-size: 20px;
            }
        }
    }
}

@media (max-width: 550px) {
    .card-panel-description {
        display: none;
    }

    .card-panel-icon-wrapper {
        float: none !important;
        width: 100%;
        height: 100%;
        margin: 0 !important;
    }
}

.m-echarts-container {
    width: 100% !important;
    height: 300px !important;
}
</style>
